var c=void 0,h=null,m;m||(m={});
(function(){function a(a){return a<10?"0"+a:a}function b(a){f.lastIndex=0;return f.test(a)?'"'+a.replace(f,function(a){var d=k[a];return typeof d==="string"?d:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function d(a,e){var f,p,o,k,s=j,l,g=e[a];g&&typeof g==="object"&&typeof g.toJSON==="function"&&(g=g.toJSON(a));typeof i==="function"&&(g=i.call(e,a,g));switch(typeof g){case "string":return b(g);case "number":return isFinite(g)?String(g):"null";case "boolean":case "null":return String(g);
case "object":if(!g)return"null";j+=n;l=[];if(Object.prototype.toString.apply(g)==="[object Array]"){k=g.length;for(f=0;f<k;f+=1)l[f]=d(f,g)||"null";o=l.length===0?"[]":j?"[\n"+j+l.join(",\n"+j)+"\n"+s+"]":"["+l.join(",")+"]";j=s;return o}if(i&&typeof i==="object"){k=i.length;for(f=0;f<k;f+=1)typeof i[f]==="string"&&(p=i[f],(o=d(p,g))&&l.push(b(p)+(j?": ":":")+o))}else for(p in g)Object.prototype.hasOwnProperty.call(g,p)&&(o=d(p,g))&&l.push(b(p)+(j?": ":":")+o);o=l.length===0?"{}":j?"{\n"+j+l.join(",\n"+
j)+"\n"+s+"}":"{"+l.join(",")+"}";j=s;return o}}if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":h},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,j,n,k={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;if(typeof m.stringify!=="function")m.stringify=function(a,b,e){var f;n=j="";if(typeof e==="number")for(f=0;f<e;f+=1)n+=" ";else typeof e==="string"&&(n=e);if((i=b)&&typeof b!=="function"&&(typeof b!=="object"||typeof b.length!=="number"))throw Error("JSON.stringify");return d("",{"":a})};
if(typeof m.parse!=="function")m.parse=function(a,d){function b(a,e){var f,j,g=a[e];if(g&&typeof g==="object")for(f in g)Object.prototype.hasOwnProperty.call(g,f)&&(j=b(g,f),j!==c?g[f]=j:delete g[f]);return d.call(a,e,g)}var f,a=String(a);e.lastIndex=0;e.test(a)&&(a=a.replace(e,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return f=eval("("+a+")"),typeof d==="function"?b({"":f},""):f;throw new SyntaxError("JSON.parse");}})();EventEmitter=function(){};EventEmitter.sa=10;EventEmitter.B=Array.B||function(a){return Object.prototype.toString.call(a)==="[object Array]"};
EventEmitter.prototype.e=function(a){if(a==="error"&&(!this.b||!this.b.error||EventEmitter.B(this.b.error)&&!this.b.error.length))if(arguments[1]instanceof Error)throw arguments[1];else throw Error("Uncaught, unspecified 'error' event.");if(this.b){var b=this.b[a];if(b)if(typeof b=="function")switch(arguments.length){case 1:b.call(this);break;case 2:b.call(this,arguments[1]);break;case 3:b.call(this,arguments[1],arguments[2]);break;default:var d=Array.prototype.slice.call(arguments,1);b.apply(this,
d)}else if(EventEmitter.B(b))for(var d=Array.prototype.slice.call(arguments,1),b=b.slice(),e=0,f=b.length;e<f;e++)b[e].apply(this,d)}};
EventEmitter.prototype.z=function(a,b){if("function"!==typeof b)throw Error("addListener only takes instances of Function");if(!this.b)this.b={};this.e("newListener",a,b);if(this.b[a])if(EventEmitter.B(this.b[a])){if(this.b[a].push(b),!this.b[a].za){var d;if((d=this.b.ua!==c?this.b.ua:EventEmitter.sa)&&d>0&&this.b[a].length>d)this.b[a].za=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this.b[a].length),
console.Ea()}}else this.b[a]=[this.b[a],b];else this.b[a]=b;return this};EventEmitter.prototype.P=EventEmitter.prototype.z;
function q(a,b){var d="error";function e(){var a=f,n=d,k=e;if("function"!==typeof k)throw Error("removeListener only takes instances of Function");if(a.b&&a.b[n]){var i=a.b[n];if(EventEmitter.B(i)){for(var t=-1,r=0,w=i.length;r<w;r++)if(i[r]===k||i[r].O&&i[r].O===k){t=r;break}t<0||(i.splice(t,1),i.length==0&&delete a.b[n])}else(i===k||i.O&&i.O===k)&&delete a.b[n]}b.apply(this,arguments)}if("function"!==typeof b)throw Error(".once only takes instances of Function");var f=a;e.O=b;f.P(d,e)}
EventEmitter.prototype.va=function(a){arguments.length===0?this.b={}:a&&this.b&&this.b[a]&&(this.b[a]=h)};
function u(a){u.g.constructor.call(this);a=u.i.aa({host:document.location.hostname,port:4E3,xa:!1,ba:["webSocket","longPolling","JSONPLongPolling"]},a);this.G=u.v.Q;this.fa=[];this.wa=new u.la(this);this.H=h;this.ea=[];this.o=new u.C(a);var b=this;this.o.P("message",function(a){var e=b.wa;if(a.A==c||a.H==c||a.id==c)e.q.e("error","Beseda receive incorrect message",a);else if(a.A.indexOf("/meta/")==0){var f=a.A.substr(6);!f in["connect","error","subscribe","unsubscribe"]?e.q.e("error","Unsupported meta channel "+
a.A,a):e["_"+f].call(e,a)}else"successful"in a?(a.Da||e.q.e("error",a.error,a),e.q.e("message:"+a.id,a.error,a),e.q.e("publish",a.error,a)):(e.q.e("message:"+a.A,a.data,a),e.q.e("message",a.A,a.data,a))});this.o.P("error",function(){b.G=u.v.Q;v(b);setTimeout(function(){b.r()},5E3)});this.R=h;this.S=function(a){b.H=a;a=x(b,"/meta/connect",b.R);b.o.send(a);b.R=h}}u.v={Q:0,CONNECTING:1,ka:2};u.Ba=0;
u.i={Ca:function(a){return this.aa({},a)},aa:function(a,b){for(var d in b)try{a[d]=b[d].constructor==Object?this.aa(a[d],b[d]):b[d]}catch(e){a[d]=b[d]}return a},s:function(a,b){function d(){}d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a;a.g=a.prototype.g=b.prototype;d=h},log:function(a){"console"in window&&"log"in console&&console.log(a)},I:h,ca:h,ya:function(a){a=a||10;if(!this.I)this.I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),this.ca=this.I.length;
for(var b=0,d=[];b<a;b++)d[b]=this.I[0|Math.random()*this.ca];return d.join("")}};u.i.s(u,EventEmitter);
u.prototype.r=function(a,b,d,e){if(this.G==u.v.ka)return!1;this.G=u.v.CONNECTING;this.R=e;e=this.o;if(!e.b)e.b={};e.b.connect||(e.b.connect=[]);EventEmitter.B(e.b.connect)||(e.b.connect=[e.b.connect]);e.b.connect.length||this.o.P("connect",this.S);this.o.r(a,b,d);for(var f in this.ea)console.log(f),a=this.ea[f],this.G!=u.v.Q&&(a=x(this,"/meta/subscribe",a),this.G==u.v.CONNECTING?this.fa.push(a):this.o.send(a));return this};function v(a){a.H=h;a.fa=[]}
function x(a,b,d){d=d||{};d.id=u.i.ya();d.A=b;d.H=a.H;return d}u.la=function(a){this.q=a};u.C=function(a){u.C.g.constructor.call(this);this.U=a;this.X=u.a.ta(a);this.X.m=this};u.i.s(u.C,EventEmitter);u.C.prototype.r=function(a,b,d){a=a&&a.length!==0?a:this.U.host;b=!isNaN(b)?b:this.U.port;d=d!==c?d:this.U.xa;this.X.r(a,b,d)};u.C.prototype.send=function(a){for(var a=[].concat(a),b=[],d=0;d<a.length;d++)b.push(a[d].id);this.X.send(m.stringify(a),b)};
u.a=function(){this.m=this.D=this.w=this.Z=h;this.V=[]};u.a.qa={longPolling:"LongPolling",JSONPLongPolling:"JSONPLongPolling",webSocket:"WebSocket"};u.a.ta=function(a){for(var b=0;b<a.ba.length;b++){var d=u.a[u.a.qa[a.ba[b]]];if(d){if(d.$(a))return new d}else throw Error("Ivalid transport "+a.ba[b]);}};u.a.prototype.r=function(){throw Error("Abstract method calling.");};u.a.prototype.send=function(){throw Error("Abstract method calling.");};
u.a.prototype.M=function(a){this.D=a;for(this.m&&this.m.e("connect",this.D);this.V.length;)this.send(this.V.shift())};u.a.prototype.N=function(a){if(a)for(;a.length;)this.m.e("message",a.shift())};
u.a.n=function(){u.a.n.g.constructor.call(this);this.h=h;this.w="webSocket";this.W=!0;this.K=[];var a=this;this.ma=function(){a.W=!1};this.T=function(b){var d=b.data;console.log(d);try{d=m.parse(b.data)}catch(e){}if(a.W){if(d){for(b=d.length-1;b>=0;)a.K.splice(a.K.indexOf(d[b].id),1),b--;u.a.n.g.N.call(a,d)}}else if(d)u.a.n.g.M.call(a,d.ra),a.W=!0};this.J=function(b){y(a,b);a.h.close();a.h=h};this.na=function(b){y(a,b);a.h.close();a.h=h}};u.i.s(u.a.n,u.a);u.a.n.$=function(){return!1};
u.a.n.prototype.r=function(a,b,d){this.h=new WebSocket("ws"+(d?"s":"")+"://"+a+(b?":"+b:"")+"/beseda/io/"+this.w+"/"+(new Date).getTime());this.h.addEventListener("open",this.ma);this.h.addEventListener("message",this.T);this.h.addEventListener("error",this.J);this.h.addEventListener("close",this.na)};u.a.n.prototype.send=function(a){this.h.send(a)};function y(a,b){for(var d=a.K.length-1;d>=0;)self.m.e("message:"+a.K[d],b),d--;a.m.e("error")}
u.a.c=function(){u.a.c.g.constructor.call(this);this.w="longPolling";this.L=this.k=this.p=this.F=h;this.ha=this.ja="";var a=this;this.S=function(b){a.M(b)};this.T=function(b){a.N(b)};this.J=function(){a.m.e("error")};this.oa=function(){a.k.va("error")}};u.i.s(u.a.c,u.a);u.a.c.$=function(a){return document.location.hostname===a.host};u.a.c.prototype.ia=function(){this.F=new u.a.c.l("GET");this.p=new u.a.c.l("GET");this.k=new u.a.c.l("PUT");this.L=new u.a.c.l("DELETE")};
u.a.c.prototype.r=function(a,b,d){this.ia();this.F.z("ready",this.S);this.F.z("error",this.J);this.p.z("ready",this.T);this.p.z("error",this.J);this.k.z("ready",this.oa);this.Z=(d?"https":"http")+"://"+a+":"+b+"/beseda/io";this.F.send(this.Z+"/"+this.w)};u.a.c.prototype.send=function(a,b){if(this.D){this.k.data=a;this.k.send();var d=this;q(this.k,function(a){for(var f=b.length-1;f>=0;)d.m.e("message:"+b[f],a),f--})}else this.V.push(a)};
u.a.c.prototype.M=function(a){if(a=this.Y(a).ra)this.k.url=this.p.url=this.L.url=this.Z+"/"+this.w+"/"+a,this.k.url+=this.ja,this.L.url+=this.ha,u.a.c.g.M.call(this,a),this.D&&this.p.send()};u.a.c.prototype.Y=function(a){return m.parse(a)};u.a.c.prototype.N=function(a){a=this.Y(a);u.a.c.g.N.call(this,a);this.D&&this.p.send()};u.a.c.l=function(a){u.a.c.l.g.constructor.call(this);this.url=h;this.method=a||"GET";this.data=h};u.i.s(u.a.c.l,EventEmitter);
u.a.c.l.prototype.send=function(a){if(a)this.url=a;a=this.url+"/"+(new Date).getTime();b!=h&&b.abort();var b=+"\u000b1"?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),d=this;b.onreadystatechange=function(){d.ga(b)};this.method==="GET"&&this.data&&(a+=(a.indexOf("?")===-1?"?":"&")+this.data);b.open(this.method,encodeURI(a),!0);a=h;if(this.method!=="GET")a=this.data,b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.send(a)};
u.a.c.l.prototype.ga=function(a){if(a.readyState===4)a.status===200?this.e("ready",a.responseText):(this.e("error"),this.ga=h),a.onreadystatechange=h,a.abort()};u.a.d=function(){u.a.d.g.constructor.call(this);this.w="JSONPLongPolling";this.ja="/send";this.ha="/destroy"};u.i.s(u.a.d,u.a.c);u.a.d.$=function(){return!0};u.a.d.prototype.ia=function(){this.F=new u.a.d.f;this.p=new u.a.d.f;this.k=new u.a.d.f;this.L=new u.a.d.f};u.a.d.prototype.Y=function(a){return a};
u.a.d.f=function(){u.a.d.f.g.constructor.call(this);this.url=h;this.data="";this.t=++u.a.d.f.pa;this.j=0;this.u={};u.a.d.f.da[this.t]={}};u.i.s(u.a.d.f,EventEmitter);u.a.d.f.da=[];u.a.d.f.pa=0;
u.a.d.f.prototype.send=function(a){if(a)this.url=a;(function(a,d,e){u.a.d.f.da[d.t][a]=function(f){clearTimeout(e);document.body.removeChild(document.getElementById("request_"+d.t+"_"+a));delete d.u[a];d.e("ready",f)}})(this.j,this,function(a,d){return setTimeout(function(){document.body.removeChild(document.getElementById("request_"+d.t+"_"+a));delete d.u[a];d.e("error")},15E3)}(this.j,this));a=this.url+"/"+(new Date).getTime();a+=(a.indexOf("?")===-1?"?":"&")+"callback=Beseda.Transport.JSONPLongPolling.JSONPRequest.__callbacks["+
this.t+"]["+this.j+"]&"+(new Date).getTime()+"&messages="+this.data;this.u[this.j]=document.createElement("script");this.u[this.j].src=a;this.u[this.j].id="request_"+this.t+"_"+this.j;document.body.appendChild(this.u[this.j]);this.data=h;this.j++};u.a.d.Aa=function(){u.a.d.f.g.constructor.call(this);this.url=h};
var d=null,i;i||(i={});
(function(){function a(a){return a<10?"0"+a:a}function b(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var c=k[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(a,f){var l,e,p,k,r=j,m,g=f[a];g&&typeof g==="object"&&typeof g.toJSON==="function"&&(g=g.toJSON(a));typeof h==="function"&&(g=h.call(f,a,g));switch(typeof g){case "string":return b(g);case "number":return isFinite(g)?String(g):"null";case "boolean":case "null":return String(g);case "object":if(!g)return"null";
j+=n;m=[];if(Object.prototype.toString.apply(g)==="[object Array]"){k=g.length;for(l=0;l<k;l+=1)m[l]=c(l,g)||"null";p=m.length===0?"[]":j?"[\n"+j+m.join(",\n"+j)+"\n"+r+"]":"["+m.join(",")+"]";j=r;return p}if(h&&typeof h==="object"){k=h.length;for(l=0;l<k;l+=1)typeof h[l]==="string"&&(e=h[l],(p=c(e,g))&&m.push(b(e)+(j?": ":":")+p))}else for(e in g)Object.prototype.hasOwnProperty.call(g,e)&&(p=c(e,g))&&m.push(b(e)+(j?": ":":")+p);p=m.length===0?"{}":j?"{\n"+j+m.join(",\n"+j)+"\n"+r+"}":"{"+m.join(",")+
"}";j=r;return p}}if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":d},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,j,n,k={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;if(typeof i.stringify!=="function")i.stringify=function(a,b,f){var e;n=j="";if(typeof f==="number")for(e=0;e<f;e+=1)n+=" ";else typeof f==="string"&&(n=f);if((h=b)&&typeof b!=="function"&&(typeof b!=="object"||typeof b.length!=="number"))throw Error("JSON.stringify");return c("",{"":a})};
if(typeof i.parse!=="function")i.parse=function(a,c){function b(a,f){var e,j,g=a[f];if(g&&typeof g==="object")for(e in g)Object.prototype.hasOwnProperty.call(g,e)&&(j=b(g,e),j!==void 0?g[e]=j:delete g[e]);return c.call(a,f,g)}var e,a=String(a);f.lastIndex=0;f.test(a)&&(a=a.replace(f,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e=eval("("+a+")"),typeof c==="function"?b({"":e},""):e;throw new SyntaxError("JSON.parse");}})();EventEmitter=function(){};EventEmitter.ka=10;EventEmitter.w=Array.w||function(a){return Object.prototype.toString.call(a)==="[object Array]"};
EventEmitter.prototype.e=function(a){if(a==="error"&&(!this.b||!this.b.error||EventEmitter.w(this.b.error)&&!this.b.error.length))if(arguments[1]instanceof Error)throw arguments[1];else throw Error("Uncaught, unspecified 'error' event.");if(this.b){var b=this.b[a];if(b)if(typeof b=="function")switch(arguments.length){case 1:b.call(this);break;case 2:b.call(this,arguments[1]);break;case 3:b.call(this,arguments[1],arguments[2]);break;default:var c=Array.prototype.slice.call(arguments,1);b.apply(this,
c)}else if(EventEmitter.w(b))for(var c=Array.prototype.slice.call(arguments,1),b=b.slice(),f=0,e=b.length;f<e;f++)b[f].apply(this,c)}};
EventEmitter.prototype.s=function(a,b){if("function"!==typeof b)throw Error("addListener only takes instances of Function");if(!this.b)this.b={};this.e("newListener",a,b);if(this.b[a])if(EventEmitter.w(this.b[a])){if(this.b[a].push(b),!this.b[a].ra){var c;if((c=this.b.ma!==void 0?this.b.ma:EventEmitter.ka)&&c>0&&this.b[a].length>c)this.b[a].ra=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this.b[a].length),
console.xa()}}else this.b[a]=[this.b[a],b];else this.b[a]=b;return this};EventEmitter.prototype.J=EventEmitter.prototype.s;
function o(a,b){var c="error";function f(){var a=e,n=c,k=f;if("function"!==typeof k)throw Error("removeListener only takes instances of Function");if(a.b&&a.b[n]){var h=a.b[n];if(EventEmitter.w(h)){for(var s=-1,q=0,l=h.length;q<l;q++)if(h[q]===k||h[q].I&&h[q].I===k){s=q;break}s<0||(h.splice(s,1),h.length==0&&delete a.b[n])}else(h===k||h.I&&h.I===k)&&delete a.b[n]}b.apply(this,arguments)}if("function"!==typeof b)throw Error(".once only takes instances of Function");var e=a;f.I=b;e.J(c,f)}
EventEmitter.prototype.na=function(a){arguments.length===0?this.b={}:a&&this.b&&this.b[a]&&(this.b[a]=d)};
function t(a){t.g.constructor.call(this);a=t.j.U({host:document.location.hostname,port:4E3,pa:!1,V:["longPolling","JSONPLongPolling"]},a);this.C=t.r.K;this.ia=[];this.oa=new t.ea(this);this.H=d;this.Y=[];this.l=new t.z(a);var b=this;this.l.J("message",function(a){var f=b.oa;if(a.t==void 0||a.H==void 0||a.id==void 0)f.n.e("error","Beseda receive incorrect message",a);else if(a.t.indexOf("/meta/")==0){var e=a.t.substr(6);!e in["connect","error","subscribe","unsubscribe"]?f.n.e("error","Unsupported meta channel "+
a.t,a):f["_"+e].call(f,a)}else"successful"in a?(a.wa||f.n.e("error",a.error,a),f.n.e("message:"+a.id,a.error,a),f.n.e("publish",a.error,a)):(f.n.e("message:"+a.t,a.data,a),f.n.e("message",a.t,a.data,a))});this.l.J("error",function(){b.C=t.r.K;setTimeout(function(){b.u()},5E3)});this.L=d;this.M=function(a){b.H=a;a=u(b,"/meta/connect",b.L);b.l.send(a);b.L=d}}t.r={K:0,CONNECTING:1,da:2};t.ta=0;
t.j={ua:function(a){return this.U({},a)},U:function(a,b){for(var c in b)try{a[c]=b[c].constructor==Object?this.U(a[c],b[c]):b[c]}catch(f){a[c]=b[c]}return a},v:function(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.g=a.prototype.g=b.prototype;c=d},log:function(a){"console"in window&&"log"in console&&console.log(a)},D:d,W:d,qa:function(a){a=a||10;if(!this.D)this.D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),this.W=this.D.length;
for(var b=0,c=[];b<a;b++)c[b]=this.D[0|Math.random()*this.W];return c.join("")}};t.j.v(t,EventEmitter);t.prototype.u=function(a,b){if(this.C==t.r.da)return!1;this.C=t.r.CONNECTING;this.L=b;var c=this.l;if(!c.b)c.b={};c.b.connect||(c.b.connect=[]);EventEmitter.w(c.b.connect)||(c.b.connect=[c.b.connect]);c.b.connect.length||this.l.J("connect",this.M);this.l.u();for(var f in this.Y)c=this.Y[f],this.C!=t.r.K&&(c=u(this,"/meta/subscribe",c),this.C==t.r.CONNECTING?this.ia.push(c):this.l.send(c));return this};
function u(a,b,c){c=c||{};c.id=t.j.qa();c.t=b;c.H=a.H;return c}t.ea=function(a){this.n=a};t.z=function(a){t.z.g.constructor.call(this);this.N=a;this.P=t.a.la(a);this.P.q=this};t.j.v(t.z,EventEmitter);t.z.prototype.u=function(){this.P.u(this.N.host,this.N.port,this.N.pa)};t.z.prototype.send=function(a){for(var a=[].concat(a),b=[],c=0;c<a.length;c++)b.push(a[c].id);this.P.send(i.stringify(a),b)};t.a=function(){this.q=this.A=this.G=this.T=d;this.O=[]};t.a.ja={longPolling:"LongPolling",JSONPLongPolling:"JSONPLongPolling"};
t.a.la=function(a){for(var b=0;b<a.V.length;b++){var c=t.a[t.a.ja[a.V[b]]];if(c){if(c.ca(a))return new c}else throw Error("Ivalid transport "+a.V[b]);}};t.a.prototype.u=function(){throw Error("Abstract method calling.");};t.a.prototype.send=function(){throw Error("Abstract method calling.");};t.a.prototype.Q=function(a){this.A=a;for(this.q&&this.q.e("connect",this.A);this.O.length;)this.send(this.O.shift())};t.a.prototype.R=function(a){if(a)for(;a.length;)this.q.e("message",a.shift())};
t.a.d=function(){t.a.d.g.constructor.call(this);this.G="longPolling";this.F=this.i=this.m=this.B=d;this.$=this.ba="";this.aa();var a=this;this.M=function(b){a.Q(b)};this.fa=function(b){a.R(b)};this.Z=function(){a.q.e("error")};this.ga=function(){a.i.na("error")};this.B.s("ready",this.M);this.B.s("error",this.Z);this.m.s("ready",this.fa);this.m.s("error",this.Z);this.i.s("ready",this.ga)};t.j.v(t.a.d,t.a);t.a.d.ca=function(a){return document.location.hostname===a.host};
t.a.d.prototype.aa=function(){this.B=new t.a.d.k("GET");this.m=new t.a.d.k("GET");this.i=new t.a.d.k("PUT");this.F=new t.a.d.k("DELETE")};t.a.d.prototype.u=function(a,b,c){this.T=(c?"https":"http")+"://"+a+":"+b+"/beseda/io";this.B.send(this.T+"/"+this.G)};t.a.d.prototype.send=function(a,b){if(this.A){this.i.data=a;this.i.send();var c=this;o(this.i,function(a){for(var e=b.length-1;e>=0;)c.q.e("message:"+b[e],a),e--})}else this.O.push(a)};
t.a.d.prototype.Q=function(a){if(a=this.S(a).va)this.i.url=this.m.url=this.F.url=this.T+"/"+this.G+"/"+a,this.i.url+=this.ba,this.F.url+=this.$,t.a.d.g.Q.call(this,a),this.A&&this.m.send()};t.a.d.prototype.S=function(a){return i.parse(a)};t.a.d.prototype.R=function(a){a=this.S(a);t.a.d.g.R.call(this,a);this.A&&this.m.send()};t.a.d.k=function(a){t.a.d.k.g.constructor.call(this);this.url=d;this.method=a||"GET";this.data=d};t.j.v(t.a.d.k,EventEmitter);
t.a.d.k.prototype.send=function(a){if(a)this.url=a;a=this.url+"/"+(new Date).getTime();b!=d&&b.abort();var b=+"\u000b1"?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),c=this;b.onreadystatechange=function(){var a=b;if(a.readyState===4)a.status===200?c.e("ready",a.responseText):c.e("error"),a.onreadystatechange=d,a.abort()};this.method==="GET"&&this.data&&(a+=(a.indexOf("?")===-1?"?":"&")+this.data);b.open(this.method,encodeURI(a),!0);a=d;if(this.method!=="GET")a=this.data,b.setRequestHeader("Content-Type",
"application/x-www-form-urlencoded");b.send(a)};t.a.c=function(){t.a.c.g.constructor.call(this);this.G="JSONPLongPolling";this.ba="/send";this.$="/destroy"};t.j.v(t.a.c,t.a.d);t.a.c.ca=function(){return!0};t.a.c.prototype.aa=function(){this.B=new t.a.c.f;this.m=new t.a.c.f;this.i=new t.a.c.f;this.F=new t.a.c.f};t.a.c.prototype.S=function(a){return a};t.a.c.f=function(){t.a.c.f.g.constructor.call(this);this.url=d;this.data="";this.o=++t.a.c.f.ha;this.h=0;this.p={};t.a.c.f.X[this.o]={}};
t.j.v(t.a.c.f,EventEmitter);t.a.c.f.X=[];t.a.c.f.ha=0;
t.a.c.f.prototype.send=function(a){if(a)this.url=a;(function(a,c,f){t.a.c.f.X[c.o][a]=function(e){clearTimeout(f);document.body.removeChild(document.getElementById("request_"+c.o+"_"+a));delete c.p[a];c.e("ready",e)}})(this.h,this,function(a,c){return setTimeout(function(){document.body.removeChild(document.getElementById("request_"+c.o+"_"+a));delete c.p[a];c.e("error")},15E3)}(this.h,this));a=this.url+"/"+(new Date).getTime();a+=(a.indexOf("?")===-1?"?":"&")+"callback=Beseda.Transport.JSONPLongPolling.JSONPRequest.__callbacks["+
this.o+"]["+this.h+"]&"+(new Date).getTime()+"&messages="+this.data;this.p[this.h]=document.createElement("script");this.p[this.h].src=a;this.p[this.h].id="request_"+this.o+"_"+this.h;document.body.appendChild(this.p[this.h]);this.data=d;this.h++};t.a.c.sa=function(){t.a.c.f.g.constructor.call(this);this.url=d};
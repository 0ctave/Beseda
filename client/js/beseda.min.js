var c=void 0,i=null,j,n;n||(n={});
(function(){function a(a){return a<10?"0"+a:a}function b(a){f.lastIndex=0;return f.test(a)?'"'+a.replace(f,function(a){var b=x[a];return typeof b==="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function d(a,e){var m,p,f,r,s=l,k,g=e[a];g&&typeof g==="object"&&typeof g.toJSON==="function"&&(g=g.toJSON(a));typeof o==="function"&&(g=o.call(e,a,g));switch(typeof g){case "string":return b(g);case "number":return isFinite(g)?String(g):"null";case "boolean":case "null":return String(g);
case "object":if(!g)return"null";l+=t;k=[];if(Object.prototype.toString.apply(g)==="[object Array]"){r=g.length;for(m=0;m<r;m+=1)k[m]=d(m,g)||"null";f=k.length===0?"[]":l?"[\n"+l+k.join(",\n"+l)+"\n"+s+"]":"["+k.join(",")+"]";l=s;return f}if(o&&typeof o==="object"){r=o.length;for(m=0;m<r;m+=1)typeof o[m]==="string"&&(p=o[m],(f=d(p,g))&&k.push(b(p)+(l?": ":":")+f))}else for(p in g)Object.prototype.hasOwnProperty.call(g,p)&&(f=d(p,g))&&k.push(b(p)+(l?": ":":")+f);f=k.length===0?"{}":l?"{\n"+l+k.join(",\n"+
l)+"\n"+s+"}":"{"+k.join(",")+"}";l=s;return f}}if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":i},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l,t,x={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},o;if(typeof n.stringify!=="function")n.stringify=function(a,b,e){var f;t=l="";if(typeof e==="number")for(f=0;f<e;f+=1)t+=" ";else typeof e==="string"&&(t=e);if((o=b)&&typeof b!=="function"&&(typeof b!=="object"||typeof b.length!=="number"))throw Error("JSON.stringify");return d("",{"":a})};
if(typeof n.parse!=="function")n.parse=function(a,b){function d(a,e){var f,k,g=a[e];if(g&&typeof g==="object")for(f in g)Object.prototype.hasOwnProperty.call(g,f)&&(k=d(g,f),k!==c?g[f]=k:delete g[f]);return b.call(a,e,g)}var f,a=String(a);e.lastIndex=0;e.test(a)&&(a=a.replace(e,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return f=eval("("+a+")"),typeof b==="function"?d({"":f},""):f;throw new SyntaxError("JSON.parse");}})();EventEmitter=function(){};EventEmitter.sa=10;EventEmitter.M=Array.M||function(a){return Object.prototype.toString.call(a)==="[object Array]"};
EventEmitter.prototype.d=function(a){if(a==="error"&&(!this.b||!this.b.error||EventEmitter.M(this.b.error)&&!this.b.error.length))if(arguments[1]instanceof Error)throw arguments[1];else throw Error("Uncaught, unspecified 'error' event.");if(this.b){var b=this.b[a];if(b)if(typeof b=="function")switch(arguments.length){case 1:b.call(this);break;case 2:b.call(this,arguments[1]);break;case 3:b.call(this,arguments[1],arguments[2]);break;default:var d=Array.prototype.slice.call(arguments,1);b.apply(this,
d)}else if(EventEmitter.M(b))for(var d=Array.prototype.slice.call(arguments,1),b=b.slice(),e=0,f=b.length;e<f;e++)b[e].apply(this,d)}};
EventEmitter.prototype.K=function(a,b){if("function"!==typeof b)throw Error("addListener only takes instances of Function");if(!this.b)this.b={};this.d("newListener",a,b);if(this.b[a])if(EventEmitter.M(this.b[a])){if(this.b[a].push(b),!this.b[a].ya){var d;if((d=this.b.ua!==c?this.b.ua:EventEmitter.sa)&&d>0&&this.b[a].length>d)this.b[a].ya=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this.b[a].length),
console.Da()}}else this.b[a]=[this.b[a],b];else this.b[a]=b;return this};EventEmitter.prototype.ba=EventEmitter.prototype.K;
function q(a){q.f.constructor.call(this);a=q.i.aa({host:document.location.hostname,port:4E3,wa:!1,ca:["webSocket","longPolling","JSONPLongPolling"]},a);this.J=q.C.R;this.fa=[];this.va=new q.na(this);this.L=i;this.S=[];this.l=new q.v(a);var b=this;this.l.ba("message",function(a){var e=b.va;if(a.D==c||a.L==c||a.id==c)e.r.d("error","Beseda receive incorrect message",a);else if(a.D.indexOf("/meta/")==0){var f=a.D.substr(6);!f in["connect","error","subscribe","unsubscribe"]?e.r.d("error","Unsupported meta channel "+
a.D,a):e["_"+f].call(e,a)}else"successful"in a?(a.Ca||e.r.d("error",a.error,a),e.r.d("message:"+a.id,a.error,a),e.r.d("publish",a.error,a)):(e.r.d("message:"+a.D,a.data,a),e.r.d("message",a.D,a.data,a))});this.l.ba("error",function(){u(b);setTimeout(function(){b.s()},5E3)});this.T=i;this.oa=function(a){b.L=a;a=v(b,"/meta/connect",b.T);b.l.send(a);b.T=i}}q.C={R:0,CONNECTING:1,ma:2};q.Aa=0;
q.i={Ba:function(a){return this.aa({},a)},aa:function(a,b){for(var d in b)try{a[d]=b[d].constructor==Object?this.aa(a[d],b[d]):b[d]}catch(e){a[d]=b[d]}return a},u:function(a,b){function d(){}d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a;a.f=a.prototype.f=b.prototype;d=i},log:function(a){"console"in window&&"log"in console&&console.log(a)},N:i,da:i,xa:function(a){a=a||10;if(!this.N)this.N="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),this.da=this.N.length;
for(var b=0,d=[];b<a;b++)d[b]=this.N[0|Math.random()*this.da];return d.join("")}};q.i.u(q,EventEmitter);
q.prototype.s=function(a,b,d,e){if(this.J==q.C.ma)return!1;this.J=q.C.CONNECTING;this.T=e;e=this.l;if(!e.b)e.b={};e.b.connect||(e.b.connect=[]);EventEmitter.M(e.b.connect)||(e.b.connect=[e.b.connect]);e.b.connect.length||this.l.ba("connect",this.oa);this.l.s(a,b,d);for(var f in this.S)console.log(f),a=this.S[f],this.J!=q.C.R&&(a=v(this,"/meta/subscribe",a),this.J==q.C.CONNECTING?this.fa.push(a):this.l.send(a));return this};q.prototype.t=function(){this.l.t();this.S=[];u(this);this.d("disconnect")};
function u(a){self.J=q.C.R;a.L=i;a.fa=[]}function v(a,b,d){d=d||{};d.id=q.i.xa();d.D=b;d.L=a.L;return d}q.na=function(a){this.r=a};q.v=function(a){q.v.f.constructor.call(this);this.V=a;this.P=q.a.ta(a);this.P.A=this};q.i.u(q.v,EventEmitter);q.v.prototype.s=function(a,b,d){a=a&&a.length!==0?a:this.V.host;b=!isNaN(b)?b:this.V.port;d=d!==c?d:this.V.wa;this.P.s(a,b,d)};q.v.prototype.send=function(a){a=[].concat(a);this.P.send(a)};q.v.prototype.t=function(){this.P.t()};
q.a=function(){this.A=this.ha=this.q=this.Z=i;this.m=!1;this.q=i;this.W=[];this.O={}};q.a.ra={longPolling:"LongPolling",JSONPLongPolling:"JSONPLongPolling",webSocket:"WebSocket"};q.a.ta=function(a){for(var b=0;b<a.ca.length;b++){var d=q.a[q.a.ra[a.ca[b]]];if(d){if(d.$(a))return new d}else throw Error("Ivalid transport "+a.ca[b]);}};j=q.a.prototype;j.s=function(){throw Error("Abstract method calling.");};j.send=function(a){if(this.m){for(var b=a.length-1;b>=0;)this.O[a[b].id]=!0,b--;this.X(n.stringify(a))}else this.W.push(a)};
j.X=function(){throw Error("Abstract method calling.");};j.t=function(){throw Error("Abstract method calling.");};j.ia=function(a){this.ha=a;for(this.A&&this.A.d("connect",this.ha);this.W.length;)this.send(this.W.shift())};j.ja=function(a){for(var b;a&&a.length;)b=a.shift(),this.A.d("message",b),delete this.O[b.id]};function w(a,b){for(var d in a.O)a.A.d("message:"+d,b);a.A.d("error");a.O={}}j.Q=function(a){return n.parse(a)};
q.a.h=function(){q.a.h.f.constructor.call(this);this.q="webSocket";this.n=this.F=this.G=this.o=i;this.U()};q.i.u(q.a.h,q.a);q.a.h.$=function(){return!window.h};q.a.h.prototype.U=function(){var a=this;this.G=function(){a.m=!0};this.F=function(b){b=a.Q(b.data);a.pa?q.a.h.f.ja.call(a,b):(a.pa=!0,q.a.h.f.ia.call(a,b.la))};this.n=function(b){w(a,b);a.t()}};
q.a.h.prototype.s=function(a,b,d){if(!this.m)this.o=new WebSocket("ws"+(d?"s":"")+"://"+a+(b?":"+b:"")+"/beseda/io/"+this.q+"/"+(new Date).getTime()),this.o.addEventListener("open",this.G),this.o.addEventListener("message",this.F),this.o.addEventListener("error",this.n),this.o.addEventListener("close",this.n)};q.a.h.prototype.t=function(){this.o.close();this.m=!1};q.a.h.prototype.X=function(a){this.o.send(a)};
q.a.e=function(){q.a.e.f.constructor.call(this);this.q="longPolling";this.n=this.F=this.G=this.H=this.B=this.p=this.I=i;this.U();this.ka();this.I.K("ready",this.G);this.I.K("error",this.n);this.p.K("ready",this.F);this.p.K("error",this.n)};q.i.u(q.a.e,q.a);q.a.e.$=function(a){return document.location.hostname!==a.host};j=q.a.e.prototype;
j.U=function(){var a=this;this.G=function(b){b=a.Q(b);a.m=!0;a.Y(b.la);q.a.e.f.ia.call(a,b.la);a.m&&a.p.send()};this.F=function(b){b=a.Q(b);q.a.e.f.ja.call(a,b);a.m&&a.p.send()};this.n=function(b){w(a,b)}};j.ka=function(){this.I=new q.a.e.k("GET");this.p=new q.a.e.k("GET");this.B=new q.a.e.k("PUT");this.H=new q.a.e.k("DELETE")};j.Y=function(a){this.B.url=this.p.url=this.H.url=this.Z+"/"+this.q+"/"+a};
j.s=function(a,b,d){this.Z="http"+(d?"s":"")+"://"+a+(b?":"+b:"")+"/beseda/io";this.I.send(this.Z+"/"+this.q)};j.X=function(a){this.B.data=a;this.B.send()};j.t=function(){this.H.send();this.m=!1};q.a.e.k=function(a){q.a.e.k.f.constructor.call(this);this.url=i;this.method=a;this.data=i};q.i.u(q.a.e.k,EventEmitter);
q.a.e.k.prototype.send=function(a){if(a)this.url=a;a=this.url+"/"+(new Date).getTime();b&&b.abort();var b=+"\u000b1"?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),d=this;b.onreadystatechange=function(){d.ga(b)};this.method==="GET"&&this.data&&(a+=(a.indexOf("?")===-1?"?":"&")+this.data);b.open(this.method,encodeURI(a),!0);a=i;if(this.method!=="GET")a=this.data,b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.send(a)};
q.a.e.k.prototype.ga=function(a){if(a.readyState===4)a.status===200?this.d("ready",a.responseText):(this.d("error"),this.ga=i),a.onreadystatechange=i,a.abort()};q.a.c=function(){q.a.c.f.constructor.call(this);this.q="JSONPLongPolling"};q.i.u(q.a.c,q.a.e);q.a.c.$=function(){return!0};q.a.c.prototype.ka=function(){this.I=new q.a.c.g;this.p=new q.a.c.g;this.B=new q.a.c.g;this.H=new q.a.c.g};q.a.c.prototype.Y=function(a){q.a.c.f.Y.call(this,a);this.B.url+="/send";this.H.url+="/destroy"};
q.a.c.prototype.Q=function(a){return a};q.a.c.g=function(){q.a.c.g.f.constructor.call(this);this.url=i;this.data="";this.w=++q.a.c.g.qa;this.j=0;this.z={};q.a.c.g.ea[this.w]={}};q.i.u(q.a.c.g,EventEmitter);q.a.c.g.ea=[];q.a.c.g.qa=0;
q.a.c.g.prototype.send=function(a){if(a)this.url=a;(function(a,d,e){q.a.c.g.ea[d.w][a]=function(f){clearTimeout(e);document.body.removeChild(document.getElementById("request_"+d.w+"_"+a));delete d.z[a];d.d("ready",f)}})(this.j,this,function(a,d){return setTimeout(function(){document.body.removeChild(document.getElementById("request_"+d.w+"_"+a));delete d.z[a];d.d("error")},15E3)}(this.j,this));a=this.url+"/"+(new Date).getTime();a+=(a.indexOf("?")===-1?"?":"&")+"callback=Beseda.Transport.JSONPLongPolling.JSONPRequest.__callbacks["+
this.w+"]["+this.j+"]&"+(new Date).getTime()+"&messages="+this.data;this.z[this.j]=document.createElement("script");this.z[this.j].src=a;this.z[this.j].id="request_"+this.w+"_"+this.j;document.body.appendChild(this.z[this.j]);this.data=i;this.j++};q.a.c.za=function(){q.a.c.g.f.constructor.call(this);this.url=i};
var c=null,i,j;j||(j={});
(function(){function a(a){return a<10?"0"+a:a}function b(a){f.lastIndex=0;return f.test(a)?'"'+a.replace(f,function(a){var b=w[a];return typeof b==="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function d(a,e){var m,p,f,q,r=l,k,g=e[a];g&&typeof g==="object"&&typeof g.toJSON==="function"&&(g=g.toJSON(a));typeof o==="function"&&(g=o.call(e,a,g));switch(typeof g){case "string":return b(g);case "number":return isFinite(g)?String(g):"null";case "boolean":case "null":return String(g);case "object":if(!g)return"null";
l+=s;k=[];if(Object.prototype.toString.apply(g)==="[object Array]"){q=g.length;for(m=0;m<q;m+=1)k[m]=d(m,g)||"null";f=k.length===0?"[]":l?"[\n"+l+k.join(",\n"+l)+"\n"+r+"]":"["+k.join(",")+"]";l=r;return f}if(o&&typeof o==="object"){q=o.length;for(m=0;m<q;m+=1)typeof o[m]==="string"&&(p=o[m],(f=d(p,g))&&k.push(b(p)+(l?": ":":")+f))}else for(p in g)Object.prototype.hasOwnProperty.call(g,p)&&(f=d(p,g))&&k.push(b(p)+(l?": ":":")+f);f=k.length===0?"{}":l?"{\n"+l+k.join(",\n"+l)+"\n"+r+"}":"{"+k.join(",")+
"}";l=r;return f}}if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":c},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l,s,w={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},o;if(typeof j.stringify!=="function")j.stringify=function(a,b,e){var f;s=l="";if(typeof e==="number")for(f=0;f<e;f+=1)s+=" ";else typeof e==="string"&&(s=e);if((o=b)&&typeof b!=="function"&&(typeof b!=="object"||typeof b.length!=="number"))throw Error("JSON.stringify");return d("",{"":a})};
if(typeof j.parse!=="function")j.parse=function(a,b){function d(a,e){var f,k,g=a[e];if(g&&typeof g==="object")for(f in g)Object.prototype.hasOwnProperty.call(g,f)&&(k=d(g,f),k!==void 0?g[f]=k:delete g[f]);return b.call(a,e,g)}var f,a=String(a);e.lastIndex=0;e.test(a)&&(a=a.replace(e,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return f=eval("("+a+")"),typeof b==="function"?d({"":f},""):f;throw new SyntaxError("JSON.parse");}})();EventEmitter=function(){};EventEmitter.ra=10;EventEmitter.N=Array.N||function(a){return Object.prototype.toString.call(a)==="[object Array]"};
EventEmitter.prototype.d=function(a){if(a==="error"&&(!this.b||!this.b.error||EventEmitter.N(this.b.error)&&!this.b.error.length))if(arguments[1]instanceof Error)throw arguments[1];else throw Error("Uncaught, unspecified 'error' event.");if(this.b){var b=this.b[a];if(b)if(typeof b=="function")switch(arguments.length){case 1:b.call(this);break;case 2:b.call(this,arguments[1]);break;case 3:b.call(this,arguments[1],arguments[2]);break;default:var d=Array.prototype.slice.call(arguments,1);b.apply(this,
d)}else if(EventEmitter.N(b))for(var d=Array.prototype.slice.call(arguments,1),b=b.slice(),e=0,f=b.length;e<f;e++)b[e].apply(this,d)}};
EventEmitter.prototype.L=function(a,b){if("function"!==typeof b)throw Error("addListener only takes instances of Function");if(!this.b)this.b={};this.d("newListener",a,b);if(this.b[a])if(EventEmitter.N(this.b[a])){if(this.b[a].push(b),!this.b[a].xa){var d;if((d=this.b.ta!==void 0?this.b.ta:EventEmitter.ra)&&d>0&&this.b[a].length>d)this.b[a].xa=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this.b[a].length),
console.Ca()}}else this.b[a]=[this.b[a],b];else this.b[a]=b;return this};EventEmitter.prototype.ba=EventEmitter.prototype.L;
function n(a){n.f.constructor.call(this);a=n.i.aa({host:document.location.hostname,port:4E3,va:!1,ca:["webSocket","longPolling","JSONPLongPolling"]},a);this.K=n.C.T;this.fa=[];this.ua=new n.ma(this);this.M=c;this.U=[];this.k=new n.v(a);var b=this;this.k.ba("message",function(a){var e=b.ua;if(a.D==void 0||a.M==void 0||a.id==void 0)e.r.d("error","Beseda receive incorrect message",a);else if(a.D.indexOf("/meta/")==0){var f=a.D.substr(6);!f in["connect","error","subscribe","unsubscribe"]?e.r.d("error",
"Unsupported meta channel "+a.D,a):e["_"+f].call(e,a)}else"successful"in a?(a.Ba||e.r.d("error",a.error,a),e.r.d("message:"+a.id,a.error,a),e.r.d("publish",a.error,a)):(e.r.d("message:"+a.D,a.data,a),e.r.d("message",a.D,a.data,a))});this.k.ba("error",function(){t(b);setTimeout(function(){b.s()},5E3)});this.V=c;this.na=function(a){b.M=a;a=u(b,"/meta/connect",b.V);b.k.send(a);b.V=c}}n.C={T:0,CONNECTING:1,la:2};n.za=0;
n.i={Aa:function(a){return this.aa({},a)},aa:function(a,b){for(var d in b)try{a[d]=b[d].constructor==Object?this.aa(a[d],b[d]):b[d]}catch(e){a[d]=b[d]}return a},u:function(a,b){function d(){}d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a;a.f=a.prototype.f=b.prototype;d=c},log:function(a){"console"in window&&"log"in console&&console.log(a)},O:c,da:c,wa:function(a){a=a||10;if(!this.O)this.O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),this.da=this.O.length;
for(var b=0,d=[];b<a;b++)d[b]=this.O[0|Math.random()*this.da];return d.join("")}};n.i.u(n,EventEmitter);
n.prototype.s=function(a,b,d,e){if(this.K==n.C.la)return!1;this.K=n.C.CONNECTING;this.V=e;e=this.k;if(!e.b)e.b={};e.b.connect||(e.b.connect=[]);EventEmitter.N(e.b.connect)||(e.b.connect=[e.b.connect]);e.b.connect.length||this.k.ba("connect",this.na);this.k.s(a,b,d);for(var f in this.U)console.log(f),a=this.U[f],this.K!=n.C.T&&(a=u(this,"/meta/subscribe",a),this.K==n.C.CONNECTING?this.fa.push(a):this.k.send(a));return this};n.prototype.t=function(){this.k.t();this.U=[];t(this);this.d("disconnect")};
function t(a){a.K=n.C.T;a.M=c;a.fa=[]}function u(a,b,d){d=d||{};d.id=n.i.wa();d.D=b;d.M=a.M;return d}n.ma=function(a){this.r=a};n.v=function(a){n.v.f.constructor.call(this);this.X=a;this.Q=n.a.sa(a);this.Q.A=this};n.i.u(n.v,EventEmitter);n.v.prototype.s=function(a,b,d){this.Q.s(a||this.X.host,b||this.X.port,d||this.X.va)};n.v.prototype.send=function(a){this.Q.send([].concat(a))};n.v.prototype.t=function(){this.Q.t()};
n.a=function(){this.A=this.ga=this.q=this.S=c;this.l=!1;this.q=c;this.P=[];this.H={}};n.a.qa={longPolling:"LongPolling",JSONPLongPolling:"JSONPLongPolling",webSocket:"WebSocket"};n.a.sa=function(a){for(var b=0;b<a.ca.length;b++){var d=n.a[n.a.qa[a.ca[b]]];if(d){if(d.$(a))return new d}else throw Error("Ivalid transport "+a.ca[b]);}};i=n.a.prototype;i.s=function(){throw Error("Abstract method calling.");};i.send=function(a){if(this.l){for(var b=a.length-1;b>=0;)this.H[a[b].id]=!0,b--;this.Y(j.stringify(a))}else this.P.push(a)};
i.Y=function(){throw Error("Abstract method calling.");};i.t=function(){throw Error("Abstract method calling.");};i.ha=function(a){this.ga=a;for(this.A&&this.A.d("connect",this.ga);this.P.length;)this.send(this.P.shift())};i.ia=function(a){for(var b;a&&a.length;)b=a.shift(),this.A.d("message",b),delete this.H[b.id]};function v(a,b){var d=[],e;for(e in a.H)d.push(a.H[e]),a.A.d("message:"+e,b);d.length&&a.P.push(d);a.A.d("error");a.H={}}i.R=function(a){return j.parse(a)};
n.a.h=function(){n.a.h.f.constructor.call(this);this.q="webSocket";this.n=this.F=this.G=this.o=c;this.W()};n.i.u(n.a.h,n.a);n.a.h.$=function(){return!window.h};n.a.h.prototype.W=function(){var a=this;this.G=function(){a.l=!0};this.F=function(b){b=a.R(b.data);a.oa?n.a.h.f.ia.call(a,b):(a.oa=!0,n.a.h.f.ha.call(a,b.ka))};this.n=function(b){v(a,b);a.t()}};
n.a.h.prototype.s=function(a,b,d){if(!this.l)this.o=new WebSocket("ws"+(d?"s":"")+"://"+a+(b?":"+b:"")+"/beseda/io/"+this.q+"/"+(new Date).getTime()),this.o.addEventListener("open",this.G),this.o.addEventListener("message",this.F),this.o.addEventListener("error",this.n),this.o.addEventListener("close",this.n)};n.a.h.prototype.t=function(){this.o.close();this.l=!1};n.a.h.prototype.Y=function(a){this.o.send(a)};
n.a.e=function(){n.a.e.f.constructor.call(this);this.q="longPolling";this.n=this.F=this.G=this.I=this.B=this.p=this.J=this.S=c;this.W();this.ja();this.J.L("ready",this.G);this.J.L("error",this.n);this.p.L("ready",this.F);this.p.L("error",this.n)};n.i.u(n.a.e,n.a);n.a.e.$=function(a){return document.location.hostname===a.host};i=n.a.e.prototype;
i.W=function(){var a=this;this.G=function(b){b=a.R(b);a.l=!0;a.Z(b.ka);n.a.e.f.ha.call(a,b.ka);a.l&&a.p.send()};this.F=function(b){b=a.R(b);n.a.e.f.ia.call(a,b);a.l&&a.p.send()};this.n=function(b){v(a,b)}};i.ja=function(){this.J=new n.a.e.m("GET");this.p=new n.a.e.m("GET");this.B=new n.a.e.m("PUT");this.I=new n.a.e.m("DELETE")};i.Z=function(a){this.B.url=this.p.url=this.I.url=this.S+"/"+this.q+"/"+a};
i.s=function(a,b,d){this.S="http"+(d?"s":"")+"://"+a+(b?":"+b:"")+"/beseda/io";this.J.send(this.S+"/"+this.q)};i.Y=function(a){this.B.data=a;this.B.send()};i.t=function(){this.I.send();this.l=!1};n.a.e.m=function(a){n.a.e.m.f.constructor.call(this);this.url=c;this.method=a;this.data=c};n.i.u(n.a.e.m,EventEmitter);
n.a.e.m.prototype.send=function(a){if(a)this.url=a;a=this.url+"/"+(new Date).getTime();b&&b.abort();var b=+"\u000b1"?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),d=this;b.onreadystatechange=function(){var a=b;if(a.readyState===4)a.status===200?d.d("ready",a.responseText):d.d("error"),a.onreadystatechange=c,a.abort()};this.method==="GET"&&this.data&&(a+=(a.indexOf("?")===-1?"?":"&")+this.data);b.open(this.method,encodeURI(a),!0);a=c;if(this.method!=="GET")a=this.data,b.setRequestHeader("Content-Type",
"application/x-www-form-urlencoded");b.send(a)};n.a.c=function(){n.a.c.f.constructor.call(this);this.q="JSONPLongPolling"};n.i.u(n.a.c,n.a.e);n.a.c.$=function(){return!0};n.a.c.prototype.ja=function(){this.J=new n.a.c.g;this.p=new n.a.c.g;this.B=new n.a.c.g;this.I=new n.a.c.g};n.a.c.prototype.Z=function(a){n.a.c.f.Z.call(this,a);this.B.url+="/send";this.I.url+="/destroy"};n.a.c.prototype.R=function(a){return a};
n.a.c.g=function(){n.a.c.g.f.constructor.call(this);this.url=c;this.data="";this.w=++n.a.c.g.pa;this.j=0;this.z={};n.a.c.g.ea[this.w]={}};n.i.u(n.a.c.g,EventEmitter);n.a.c.g.ea=[];n.a.c.g.pa=0;
n.a.c.g.prototype.send=function(a){if(a)this.url=a;(function(a,d,e){n.a.c.g.ea[d.w][a]=function(f){clearTimeout(e);document.body.removeChild(document.getElementById("request_"+d.w+"_"+a));delete d.z[a];d.d("ready",f)}})(this.j,this,function(a,d){return setTimeout(function(){document.body.removeChild(document.getElementById("request_"+d.w+"_"+a));delete d.z[a];d.d("error")},15E3)}(this.j,this));a=this.url+"/"+(new Date).getTime();a+=(a.indexOf("?")===-1?"?":"&")+"callback=Beseda.Transport.JSONPLongPolling.JSONPRequest.__callbacks["+
this.w+"]["+this.j+"]&"+(new Date).getTime()+"&messages="+this.data;this.z[this.j]=document.createElement("script");this.z[this.j].src=a;this.z[this.j].id="request_"+this.w+"_"+this.j;document.body.appendChild(this.z[this.j]);this.data=c;this.j++};n.a.c.ya=function(){n.a.c.g.f.constructor.call(this);this.url=c};
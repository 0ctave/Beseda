var c=void 0,h=null,l,o;o||(o={});
(function(){function a(a){return a<10?"0"+a:a}function b(a){f.lastIndex=0;return f.test(a)?'"'+a.replace(f,function(a){var b=m[a];return typeof b==="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function d(a,e){var f,r,q,m,u=k,n,g=e[a];g&&typeof g==="object"&&typeof g.toJSON==="function"&&(g=g.toJSON(a));typeof j==="function"&&(g=j.call(e,a,g));switch(typeof g){case "string":return b(g);case "number":return isFinite(g)?String(g):"null";case "boolean":case "null":return String(g);
case "object":if(!g)return"null";k+=p;n=[];if(Object.prototype.toString.apply(g)==="[object Array]"){m=g.length;for(f=0;f<m;f+=1)n[f]=d(f,g)||"null";q=n.length===0?"[]":k?"[\n"+k+n.join(",\n"+k)+"\n"+u+"]":"["+n.join(",")+"]";k=u;return q}if(j&&typeof j==="object"){m=j.length;for(f=0;f<m;f+=1)typeof j[f]==="string"&&(r=j[f],(q=d(r,g))&&n.push(b(r)+(k?": ":":")+q))}else for(r in g)Object.prototype.hasOwnProperty.call(g,r)&&(q=d(r,g))&&n.push(b(r)+(k?": ":":")+q);q=n.length===0?"{}":k?"{\n"+k+n.join(",\n"+
k)+"\n"+u+"}":"{"+n.join(",")+"}";k=u;return q}}if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":h},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,k,p,m={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},j;if(typeof o.stringify!=="function")o.stringify=function(a,b,e){var f;p=k="";if(typeof e==="number")for(f=0;f<e;f+=1)p+=" ";else typeof e==="string"&&(p=e);if((j=b)&&typeof b!=="function"&&(typeof b!=="object"||typeof b.length!=="number"))throw Error("JSON.stringify");return d("",{"":a})};
if(typeof o.parse!=="function")o.parse=function(a,b){function d(a,e){var f,k,g=a[e];if(g&&typeof g==="object")for(f in g)Object.prototype.hasOwnProperty.call(g,f)&&(k=d(g,f),k!==c?g[f]=k:delete g[f]);return b.call(a,e,g)}var f,a=String(a);e.lastIndex=0;e.test(a)&&(a=a.replace(e,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return f=eval("("+a+")"),typeof b==="function"?d({"":f},""):f;throw new SyntaxError("JSON.parse");}})();EventEmitter=function(){};EventEmitter.wa=10;EventEmitter.F=Array.F||function(a){return Object.prototype.toString.call(a)==="[object Array]"};
EventEmitter.prototype.d=function(a){if(a==="error"&&(!this.b||!this.b.error||EventEmitter.F(this.b.error)&&!this.b.error.length))if(arguments[1]instanceof Error)throw arguments[1];else throw Error("Uncaught, unspecified 'error' event.");if(this.b){var b=this.b[a];if(b)if(typeof b=="function")switch(arguments.length){case 1:b.call(this);break;case 2:b.call(this,arguments[1]);break;case 3:b.call(this,arguments[1],arguments[2]);break;default:var d=Array.prototype.slice.call(arguments,1);b.apply(this,
d)}else if(EventEmitter.F(b))for(var d=Array.prototype.slice.call(arguments,1),b=b.slice(),e=0,f=b.length;e<f;e++)b[e].apply(this,d)}};
EventEmitter.prototype.C=function(a,b){if("function"!==typeof b)throw Error("addListener only takes instances of Function");if(!this.b)this.b={};this.d("newListener",a,b);if(this.b[a])if(EventEmitter.F(this.b[a])){if(this.b[a].push(b),!this.b[a].Da){var d;if((d=this.b.ya!==c?this.b.ya:EventEmitter.wa)&&d>0&&this.b[a].length>d)this.b[a].Da=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this.b[a].length),
console.La()}}else this.b[a]=[this.b[a],b];else this.b[a]=b;return this};EventEmitter.prototype.P=EventEmitter.prototype.C;
function s(a,b){var d="error";function e(){var a=f,p=d,m=e;if("function"!==typeof m)throw Error("removeListener only takes instances of Function");if(a.b&&a.b[p]){var j=a.b[p];if(EventEmitter.F(j)){for(var v=-1,t=0,y=j.length;t<y;t++)if(j[t]===m||j[t].O&&j[t].O===m){v=t;break}v<0||(j.splice(v,1),j.length==0&&delete a.b[p])}else(j===m||j.O&&j.O===m)&&delete a.b[p]}b.apply(this,arguments)}if("function"!==typeof b)throw Error(".once only takes instances of Function");var f=a;e.O=b;f.P(d,e)}
EventEmitter.prototype.za=function(a){arguments.length===0?this.b={}:a&&this.b&&this.b[a]&&(this.b[a]=h)};
function w(a){w.g.constructor.call(this);a=w.h.Z({host:document.location.hostname,port:4E3,Ba:!1,$:["webSocket","longPolling","JSONPLongPolling"]},a);this.I=w.B.Q;this.ga=[];this.Aa=new w.oa(this);this.J=h;this.R=[];this.o=new w.w(a);var b=this;this.o.P("message",function(a){var e=b.Aa;if(a.D==c||a.J==c||a.id==c)e.s.d("error","Beseda receive incorrect message",a);else if(a.D.indexOf("/meta/")==0){var f=a.D.substr(6);!f in["connect","error","subscribe","unsubscribe"]?e.s.d("error","Unsupported meta channel "+
a.D,a):e["_"+f].call(e,a)}else"successful"in a?(a.Ka||e.s.d("error",a.error,a),e.s.d("message:"+a.id,a.error,a),e.s.d("publish",a.error,a)):(e.s.d("message:"+a.D,a.data,a),e.s.d("message",a.D,a.data,a))});this.o.P("error",function(){x(b);setTimeout(function(){b.t()},5E3)});this.S=h;this.T=function(a){b.J=a;a=z(b,"/meta/connect",b.S);b.o.send(a);b.S=h}}w.B={Q:0,CONNECTING:1,na:2};w.Ha=0;
w.h={Ja:function(a){return this.Z({},a)},Z:function(a,b){for(var d in b)try{a[d]=b[d].constructor==Object?this.Z(a[d],b[d]):b[d]}catch(e){a[d]=b[d]}return a},v:function(a,b){function d(){}d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a;a.g=a.prototype.g=b.prototype;d=h},log:function(a){"console"in window&&"log"in console&&console.log(a)},K:h,aa:h,Ca:function(a){a=a||10;if(!this.K)this.K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),this.aa=this.K.length;
for(var b=0,d=[];b<a;b++)d[b]=this.K[0|Math.random()*this.aa];return d.join("")}};w.h.v(w,EventEmitter);
w.prototype.t=function(a,b,d,e){if(this.I==w.B.na)return!1;this.I=w.B.CONNECTING;this.S=e;e=this.o;if(!e.b)e.b={};e.b.connect||(e.b.connect=[]);EventEmitter.F(e.b.connect)||(e.b.connect=[e.b.connect]);e.b.connect.length||this.o.P("connect",this.T);this.o.t(a,b,d);for(var f in this.R)console.log(f),a=this.R[f],this.I!=w.B.Q&&(a=z(this,"/meta/subscribe",a),this.I==w.B.CONNECTING?this.ga.push(a):this.o.send(a));return this};w.prototype.u=function(){this.o.u();this.R=[];x(this);this.d("disconnect")};
function x(a){self.I=w.B.Q;a.J=h;a.ga=[]}function z(a,b,d){d=d||{};d.id=w.h.Ca();d.D=b;d.J=a.J;return d}w.oa=function(a){this.s=a};w.w=function(a){w.w.g.constructor.call(this);this.U=a;this.M=w.a.xa(a);this.M.n=this};w.h.v(w.w,EventEmitter);w.w.prototype.t=function(a,b,d){a=a&&a.length!==0?a:this.U.host;b=!isNaN(b)?b:this.U.port;d=d!==c?d:this.U.Ba;this.M.t(a,b,d)};w.w.prototype.send=function(a){this.M.send([].concat(a))};w.w.prototype.u=function(){this.M.u()};
w.a=function(){this.r=this.n=this.p=this.r=this.X=h;this.V=[];this.L={}};w.a.ua={longPolling:"LongPolling",JSONPLongPolling:"JSONPLongPolling",webSocket:"WebSocket"};w.a.xa=function(a){for(var b=0;b<a.$.length;b++){var d=w.a[w.a.ua[a.$[b]]];if(d){if(d.Y(a))return new d}else throw Error("Ivalid transport "+a.$[b]);}};l=w.a.prototype;l.t=function(){throw Error("Abstract method calling.");};l.send=function(a){this.ja(o.stringify(a));for(var b=a.length-1;b>=0;)this.L[a[b].id]=!0};
l.ja=function(){throw Error("Abstract method calling.");};l.u=function(){throw Error("Abstract method calling.");};l.N=function(a){this.p=a;for(this.n&&this.n.d("connect",this.p);this.V.length;)this.send(this.V.shift())};l.ta=function(a){for(var b;a&&a.length;)b=a.shift(),this.n.d("message",b),delete this.L[b.id]};w.a.i=function(){w.a.i.g.constructor.call(this);this.r="webSocket";this.k=h;this.fa=!0;this.Ga=this.da=this.Fa=h;A(this)};w.h.v(w.a.i,w.a);w.a.i.Y=function(){return!!window.i};
function A(a){a.qa=function(){a.Ia=!1};a.da=function(){var b;try{b=o.parse(event.data)}catch(d){}a.fa?w.a.i.g.ta.call(a,b):(w.a.i.g.N.call(a,b.va),a.fa=!0)};a.ca=function(b){for(var d in a.L)a.n.d("message:"+d,b);a.n.d("error");a.L={};a.u()}}
w.a.i.prototype.t=function(a,b,d){if(!this.k)this.k=new WebSocket("ws"+(d?"s":"")+"://"+a+(b?":"+b:"")+"/beseda/io/"+this.r+"/"+(new Date).getTime()),this.k.addEventListener("open",this.qa),this.k.addEventListener("message",this.da),this.k.addEventListener("error",this.ca),this.k.addEventListener("close",this.ca)};w.a.i.prototype.ja=function(a){this.k.send(a)};w.a.i.prototype.u=function(){this.p=h;this.k.close();this.k=h};
w.a.e=function(){w.a.e.g.constructor.call(this);this.r="longPolling";this.H=this.l=this.q=this.G=h;this.ia=this.ma="";var a=this;this.T=function(b){a.N(b)};this.pa=function(b){a.ka(b)};this.ea=function(){a.n.d("error")};this.ra=function(){a.l.za("error")}};w.h.v(w.a.e,w.a);w.a.e.Y=function(a){return document.location.hostname===a.host};l=w.a.e.prototype;l.la=function(){this.G=new w.a.e.m("GET");this.q=new w.a.e.m("GET");this.l=new w.a.e.m("PUT");this.H=new w.a.e.m("DELETE")};
l.t=function(a,b,d){this.la();this.G.C("ready",this.T);this.G.C("error",this.ea);this.q.C("ready",this.pa);this.q.C("error",this.ea);this.l.C("ready",this.ra);this.X=(d?"https":"http")+"://"+a+":"+b+"/beseda/io";this.G.send(this.X+"/"+this.r)};l.send=function(a,b){if(this.p){this.l.data=a;this.l.send();var d=this;s(this.l,function(a){for(var f=b.length-1;f>=0;)d.n.d("message:"+b[f],a),f--})}else this.V.push(a)};l.u=function(){this.H.send();this.p=h};
l.N=function(a){if(a=this.W(a).va)this.l.url=this.q.url=this.H.url=this.X+"/"+this.r+"/"+a,this.l.url+=this.ma,this.H.url+=this.ia,w.a.e.g.N.call(this,a),this.p&&this.q.send()};l.W=function(a){return o.parse(a)};l.ka=function(a){a=this.W(a);w.a.e.g.ka.call(this,a);this.p&&this.q.send()};w.a.e.m=function(a){w.a.e.m.g.constructor.call(this);this.url=h;this.method=a||"GET";this.data=h};w.h.v(w.a.e.m,EventEmitter);
w.a.e.m.prototype.send=function(a){if(a)this.url=a;a=this.url+"/"+(new Date).getTime();b!=h&&b.abort();var b=+"\u000b1"?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),d=this;b.onreadystatechange=function(){d.ha(b)};this.method==="GET"&&this.data&&(a+=(a.indexOf("?")===-1?"?":"&")+this.data);b.open(this.method,encodeURI(a),!0);a=h;if(this.method!=="GET")a=this.data,b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.send(a)};
w.a.e.m.prototype.ha=function(a){if(a.readyState===4)a.status===200?this.d("ready",a.responseText):(this.d("error"),this.ha=h),a.onreadystatechange=h,a.abort()};w.a.c=function(){w.a.c.g.constructor.call(this);this.r="JSONPLongPolling";this.ma="/send";this.ia="/destroy"};w.h.v(w.a.c,w.a.e);w.a.c.Y=function(){return!0};w.a.c.prototype.la=function(){this.G=new w.a.c.f;this.q=new w.a.c.f;this.l=new w.a.c.f;this.H=new w.a.c.f};w.a.c.prototype.W=function(a){return a};
w.a.c.f=function(){w.a.c.f.g.constructor.call(this);this.url=h;this.data="";this.z=++w.a.c.f.sa;this.j=0;this.A={};w.a.c.f.ba[this.z]={}};w.h.v(w.a.c.f,EventEmitter);w.a.c.f.ba=[];w.a.c.f.sa=0;
w.a.c.f.prototype.send=function(a){if(a)this.url=a;(function(a,d,e){w.a.c.f.ba[d.z][a]=function(f){clearTimeout(e);document.body.removeChild(document.getElementById("request_"+d.z+"_"+a));delete d.A[a];d.d("ready",f)}})(this.j,this,function(a,d){return setTimeout(function(){document.body.removeChild(document.getElementById("request_"+d.z+"_"+a));delete d.A[a];d.d("error")},15E3)}(this.j,this));a=this.url+"/"+(new Date).getTime();a+=(a.indexOf("?")===-1?"?":"&")+"callback=Beseda.Transport.JSONPLongPolling.JSONPRequest.__callbacks["+
this.z+"]["+this.j+"]&"+(new Date).getTime()+"&messages="+this.data;this.A[this.j]=document.createElement("script");this.A[this.j].src=a;this.A[this.j].id="request_"+this.z+"_"+this.j;document.body.appendChild(this.A[this.j]);this.data=h;this.j++};w.a.c.Ea=function(){w.a.c.f.g.constructor.call(this);this.url=h};
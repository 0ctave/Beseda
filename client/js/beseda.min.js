var c=null,i,j;j||(j={});
(function(){function a(a){return a<10?"0"+a:a}function b(a){f.lastIndex=0;return f.test(a)?'"'+a.replace(f,function(a){var b=w[a];return typeof b==="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function d(a,e){var m,p,f,q,r=l,k,g=e[a];g&&typeof g==="object"&&typeof g.toJSON==="function"&&(g=g.toJSON(a));typeof o==="function"&&(g=o.call(e,a,g));switch(typeof g){case "string":return b(g);case "number":return isFinite(g)?String(g):"null";case "boolean":case "null":return String(g);case "object":if(!g)return"null";
l+=s;k=[];if(Object.prototype.toString.apply(g)==="[object Array]"){q=g.length;for(m=0;m<q;m+=1)k[m]=d(m,g)||"null";f=k.length===0?"[]":l?"[\n"+l+k.join(",\n"+l)+"\n"+r+"]":"["+k.join(",")+"]";l=r;return f}if(o&&typeof o==="object"){q=o.length;for(m=0;m<q;m+=1)typeof o[m]==="string"&&(p=o[m],(f=d(p,g))&&k.push(b(p)+(l?": ":":")+f))}else for(p in g)Object.prototype.hasOwnProperty.call(g,p)&&(f=d(p,g))&&k.push(b(p)+(l?": ":":")+f);f=k.length===0?"{}":l?"{\n"+l+k.join(",\n"+l)+"\n"+r+"}":"{"+k.join(",")+
"}";l=r;return f}}if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":c},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l,s,w={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},o;if(typeof j.stringify!=="function")j.stringify=function(a,b,e){var f;s=l="";if(typeof e==="number")for(f=0;f<e;f+=1)s+=" ";else typeof e==="string"&&(s=e);if((o=b)&&typeof b!=="function"&&(typeof b!=="object"||typeof b.length!=="number"))throw Error("JSON.stringify");return d("",{"":a})};
if(typeof j.parse!=="function")j.parse=function(a,b){function d(a,e){var f,k,g=a[e];if(g&&typeof g==="object")for(f in g)Object.prototype.hasOwnProperty.call(g,f)&&(k=d(g,f),k!==void 0?g[f]=k:delete g[f]);return b.call(a,e,g)}var f,a=String(a);e.lastIndex=0;e.test(a)&&(a=a.replace(e,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return f=eval("("+a+")"),typeof b==="function"?d({"":f},""):f;throw new SyntaxError("JSON.parse");}})();EventEmitter=function(){};EventEmitter.sa=10;EventEmitter.M=Array.M||function(a){return Object.prototype.toString.call(a)==="[object Array]"};
EventEmitter.prototype.d=function(a){if(a==="error"&&(!this.b||!this.b.error||EventEmitter.M(this.b.error)&&!this.b.error.length))if(arguments[1]instanceof Error)throw arguments[1];else throw Error("Uncaught, unspecified 'error' event.");if(this.b){var b=this.b[a];if(b)if(typeof b=="function")switch(arguments.length){case 1:b.call(this);break;case 2:b.call(this,arguments[1]);break;case 3:b.call(this,arguments[1],arguments[2]);break;default:var d=Array.prototype.slice.call(arguments,1);b.apply(this,
d)}else if(EventEmitter.M(b))for(var d=Array.prototype.slice.call(arguments,1),b=b.slice(),e=0,f=b.length;e<f;e++)b[e].apply(this,d)}};
EventEmitter.prototype.K=function(a,b){if("function"!==typeof b)throw Error("addListener only takes instances of Function");if(!this.b)this.b={};this.d("newListener",a,b);if(this.b[a])if(EventEmitter.M(this.b[a])){if(this.b[a].push(b),!this.b[a].ya){var d;if((d=this.b.ua!==void 0?this.b.ua:EventEmitter.sa)&&d>0&&this.b[a].length>d)this.b[a].ya=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this.b[a].length),
console.Da()}}else this.b[a]=[this.b[a],b];else this.b[a]=b;return this};EventEmitter.prototype.ba=EventEmitter.prototype.K;
function n(a){n.f.constructor.call(this);a=n.i.aa({host:document.location.hostname,port:4E3,wa:!1,ca:["webSocket","longPolling","JSONPLongPolling"]},a);this.J=n.B.R;this.fa=[];this.va=new n.na(this);this.L=c;this.S=[];this.l=new n.u(a);var b=this;this.l.ba("message",function(a){var e=b.va;if(a.D==void 0||a.L==void 0||a.id==void 0)e.q.d("error","Beseda receive incorrect message",a);else if(a.D.indexOf("/meta/")==0){var f=a.D.substr(6);!f in["connect","error","subscribe","unsubscribe"]?e.q.d("error",
"Unsupported meta channel "+a.D,a):e["_"+f].call(e,a)}else"successful"in a?(a.Ca||e.q.d("error",a.error,a),e.q.d("message:"+a.id,a.error,a),e.q.d("publish",a.error,a)):(e.q.d("message:"+a.D,a.data,a),e.q.d("message",a.D,a.data,a))});this.l.ba("error",function(){t(b);setTimeout(function(){b.r()},5E3)});this.T=c;this.oa=function(a){b.L=a;a=u(b,"/meta/connect",b.T);b.l.send(a);b.T=c}}n.B={R:0,CONNECTING:1,ma:2};n.Aa=0;
n.i={Ba:function(a){return this.aa({},a)},aa:function(a,b){for(var d in b)try{a[d]=b[d].constructor==Object?this.aa(a[d],b[d]):b[d]}catch(e){a[d]=b[d]}return a},t:function(a,b){function d(){}d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a;a.f=a.prototype.f=b.prototype;d=c},log:function(a){"console"in window&&"log"in console&&console.log(a)},N:c,da:c,xa:function(a){a=a||10;if(!this.N)this.N="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),this.da=this.N.length;
for(var b=0,d=[];b<a;b++)d[b]=this.N[0|Math.random()*this.da];return d.join("")}};n.i.t(n,EventEmitter);
n.prototype.r=function(a,b,d,e){if(this.J==n.B.ma)return!1;this.J=n.B.CONNECTING;this.T=e;e=this.l;if(!e.b)e.b={};e.b.connect||(e.b.connect=[]);EventEmitter.M(e.b.connect)||(e.b.connect=[e.b.connect]);e.b.connect.length||this.l.ba("connect",this.oa);this.l.r(a,b,d);for(var f in this.S)console.log(f),a=this.S[f],this.J!=n.B.R&&(a=u(this,"/meta/subscribe",a),this.J==n.B.CONNECTING?this.fa.push(a):this.l.send(a));return this};n.prototype.s=function(){this.l.s();this.S=[];t(this);this.d("disconnect")};
function t(a){self.J=n.B.R;a.L=c;a.fa=[]}function u(a,b,d){d=d||{};d.id=n.i.xa();d.D=b;d.L=a.L;return d}n.na=function(a){this.q=a};n.u=function(a){n.u.f.constructor.call(this);this.V=a;this.P=n.a.ta(a);this.P.z=this};n.i.t(n.u,EventEmitter);n.u.prototype.r=function(a,b,d){this.P.r(a||this.V.host,b||this.V.port,d||this.V.wa)};n.u.prototype.send=function(a){this.P.send([].concat(a))};n.u.prototype.s=function(){this.P.s()};n.a=function(){this.z=this.ha=c;this.m=!1;this.C=c;this.W=[];this.O={}};
n.a.ra={longPolling:"LongPolling",JSONPLongPolling:"JSONPLongPolling",webSocket:"WebSocket"};n.a.ta=function(a){for(var b=0;b<a.ca.length;b++){var d=n.a[n.a.ra[a.ca[b]]];if(d){if(d.$(a))return new d}else throw Error("Ivalid transport "+a.ca[b]);}};i=n.a.prototype;i.r=function(){throw Error("Abstract method calling.");};i.send=function(a){if(this.m){for(var b=a.length-1;b>=0;)this.O[a[b].id]=!0,b--;this.X(j.stringify(a))}else this.W.push(a)};i.X=function(){throw Error("Abstract method calling.");};
i.s=function(){throw Error("Abstract method calling.");};i.ia=function(a){this.ha=a;for(this.z&&this.z.d("connect",this.ha);this.W.length;)this.send(this.W.shift())};i.ja=function(a){for(var b;a&&a.length;)b=a.shift(),this.z.d("message",b),delete this.O[b.id]};function v(a,b){for(var d in a.O)a.z.d("message:"+d,b);a.z.d("error");a.O={}}i.Q=function(a){return j.parse(a)};n.a.h=function(){n.a.h.f.constructor.call(this);this.C="webSocket";this.n=this.F=this.G=this.o=c;this.U()};n.i.t(n.a.h,n.a);
n.a.h.$=function(){return!window.h};n.a.h.prototype.U=function(){var a=this;this.G=function(){a.m=!0};this.F=function(b){b=a.Q(b.data);a.pa?n.a.h.f.ja.call(a,b):(a.pa=!0,n.a.h.f.ia.call(a,b.la))};this.n=function(b){v(a,b);a.s()}};
n.a.h.prototype.r=function(a,b,d){if(!this.m)this.o=new WebSocket("ws"+(d?"s":"")+"://"+a+(b?":"+b:"")+"/beseda/io/"+this.C+"/"+(new Date).getTime()),this.o.addEventListener("open",this.G),this.o.addEventListener("message",this.F),this.o.addEventListener("error",this.n),this.o.addEventListener("close",this.n)};n.a.h.prototype.s=function(){this.o.close();this.m=!1};n.a.h.prototype.X=function(a){this.o.send(a)};
n.a.e=function(){n.a.e.f.constructor.call(this);this.C="longPolling";this.n=this.F=this.G=this.H=this.A=this.p=this.I=this.Z=c;this.U();this.ka();this.I.K("ready",this.G);this.I.K("error",this.n);this.p.K("ready",this.F);this.p.K("error",this.n)};n.i.t(n.a.e,n.a);n.a.e.$=function(a){return document.location.hostname===a.host};i=n.a.e.prototype;
i.U=function(){var a=this;this.G=function(b){b=a.Q(b);a.m=!0;a.Y(b.la);n.a.e.f.ia.call(a,b.la);a.m&&a.p.send()};this.F=function(b){b=a.Q(b);n.a.e.f.ja.call(a,b);a.m&&a.p.send()};this.n=function(b){v(a,b)}};i.ka=function(){this.I=new n.a.e.k("GET");this.p=new n.a.e.k("GET");this.A=new n.a.e.k("PUT");this.H=new n.a.e.k("DELETE")};i.Y=function(a){this.A.url=this.p.url=this.H.url=this.Z+"/"+this.C+"/"+a};
i.r=function(a,b,d){this.Z="http"+(d?"s":"")+"://"+a+(b?":"+b:"")+"/beseda/io";this.I.send(this.Z+"/"+this.C)};i.X=function(a){this.A.data=a;this.A.send()};i.s=function(){this.H.send();this.m=!1};n.a.e.k=function(a){n.a.e.k.f.constructor.call(this);this.url=c;this.method=a;this.data=c};n.i.t(n.a.e.k,EventEmitter);
n.a.e.k.prototype.send=function(a){if(a)this.url=a;a=this.url+"/"+(new Date).getTime();b&&b.abort();var b=+"\u000b1"?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),d=this;b.onreadystatechange=function(){d.ga(b)};this.method==="GET"&&this.data&&(a+=(a.indexOf("?")===-1?"?":"&")+this.data);b.open(this.method,encodeURI(a),!0);a=c;if(this.method!=="GET")a=this.data,b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.send(a)};
n.a.e.k.prototype.ga=function(a){if(a.readyState===4)a.status===200?this.d("ready",a.responseText):(this.d("error"),this.ga=c),a.onreadystatechange=c,a.abort()};n.a.c=function(){n.a.c.f.constructor.call(this);this.C="JSONPLongPolling"};n.i.t(n.a.c,n.a.e);n.a.c.$=function(){return!0};n.a.c.prototype.ka=function(){this.I=new n.a.c.g;this.p=new n.a.c.g;this.A=new n.a.c.g;this.H=new n.a.c.g};n.a.c.prototype.Y=function(a){n.a.c.f.Y.call(this,a);this.A.url+="/send";this.H.url+="/destroy"};
n.a.c.prototype.Q=function(a){return a};n.a.c.g=function(){n.a.c.g.f.constructor.call(this);this.url=c;this.data="";this.v=++n.a.c.g.qa;this.j=0;this.w={};n.a.c.g.ea[this.v]={}};n.i.t(n.a.c.g,EventEmitter);n.a.c.g.ea=[];n.a.c.g.qa=0;
n.a.c.g.prototype.send=function(a){if(a)this.url=a;(function(a,d,e){n.a.c.g.ea[d.v][a]=function(f){clearTimeout(e);document.body.removeChild(document.getElementById("request_"+d.v+"_"+a));delete d.w[a];d.d("ready",f)}})(this.j,this,function(a,d){return setTimeout(function(){document.body.removeChild(document.getElementById("request_"+d.v+"_"+a));delete d.w[a];d.d("error")},15E3)}(this.j,this));a=this.url+"/"+(new Date).getTime();a+=(a.indexOf("?")===-1?"?":"&")+"callback=Beseda.Transport.JSONPLongPolling.JSONPRequest.__callbacks["+
this.v+"]["+this.j+"]&"+(new Date).getTime()+"&messages="+this.data;this.w[this.j]=document.createElement("script");this.w[this.j].src=a;this.w[this.j].id="request_"+this.v+"_"+this.j;document.body.appendChild(this.w[this.j]);this.data=c;this.j++};n.a.c.za=function(){n.a.c.g.f.constructor.call(this);this.url=c};
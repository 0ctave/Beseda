var b=null;
function f(a){f.h.constructor.call(this);this.options=f.n.O({host:document.location.hostname,port:4E3,ea:!1,P:["longPolling","JSONPLongPolling"]},a);this.ia={};this.D=f.A.H;this.ja=[];this.da=new f.W(this);this.C=b;this.ha=[];this.q=new f.u(this.options);var c=this;this.q.G("message",function(a){var e=c.da;if(a.j==void 0||a.C==void 0||a.id==void 0)e.f.log("Beseda receive incorrect message",a),e.f.d("error",a);else if(a.j.indexOf("/meta/")==0){var g=a.j.substr(6);!g in["connect","error","subscribe",
"unsubscribe"]?(e.f.log("Unsupported meta channel "+a.j),e.f.d("error",a)):e["_"+g].call(e,a)}else"successful"in a?(e.f.d("message:"+a.j+":"+a.id,a.error,a),a.ma?e.f.log("Beseda publish to "+a.j,a):(e.f.log("Beseda publish request declined",a),e.f.d("error",a))):(e.f.log("Beseda get a new message from "+a.j,a),e.f.d("message:"+a.j,a.data,a),e.f.d("message",a.j,a.data,a))});this.q.G("disconnect",function(){c.D=f.A.H;c.d("disconnect");c.log("Beseda disconnected")});this.q.G("error",function(){c.D=f.A.H;
setTimeout(function(){c.s()},1E3)})}f.k=function(){this.g={}};f.k.prototype.B=function(a,c){this.g[a]||(this.g[a]=[]);this.g[a].push(c)};f.k.prototype.G=f.k.prototype.B;function h(a,c){function d(){c.apply(a,arguments);var e=d;if(a.g.connect)for(var g=0;g<a.g.connect.length;g++)a.g.connect[g]===e&&a.g.connect.splice(g,1)}a.G("connect",d)}f.k.prototype.d=function(){var a=Array.prototype.slice.call(arguments),c=a.shift();if(this.g[c])for(var d=0;d<this.g[c].length;d++)this.g[c][d].apply(this,a)};
f.n={ka:function(a){return this.O({},a)},O:function(a,c){for(var d in c)try{a[d]=c[d].constructor==Object?this.O(a[d],c[d]):c[d]}catch(e){a[d]=c[d]}return a},t:function(a,c){function d(){}d.prototype=c.prototype;a.prototype=new d;a.prototype.constructor=a;a.h=a.prototype.h=c.prototype;d=b}};f.n.t(f,f.k);
f.prototype.s=function(a,c){if(this.D==f.A.V)return!1;this.D=f.A.CONNECTING;var d=this;h(this.q,function(a){d.C=a;a=(a=c)||{};a.id=d.C+"_"+ ++f.$;a.j="/meta/connect";a.C=d.C;a=JSON.stringify(a);d.q.send(a);d.log("Beseda send connection request",a)});this.q.s()};f.prototype.log=function(){"console"in window&&"log"in console&&console.log.apply(console,arguments)};f.A={H:0,CONNECTING:1,V:2};f.$=0;f.W=function(a){this.f=a};
f.u=function(a){f.u.h.constructor.call(this);this.I=a;this.K=f.a.ca(a);this.K.z=this};f.n.t(f.u,f.k);f.u.prototype.s=function(){this.K.s(this.I.host,this.I.port,this.I.ea)};f.u.prototype.send=function(a){this.K.send(a)};f.a=function(){this.z=this.v=this.F=this.N=b;this.J=[]};f.a.fa="|";f.a.aa={longPolling:"LongPolling",JSONPLongPolling:"JSONPLongPolling"};
f.a.ca=function(a){for(var c=0;c<a.P.length;c++){var d=f.a[f.a.aa[a.P[c]]];if(d){if(d.U(a))return new d}else throw Error("Ivalid transport "+a.P[c]);}};f.a.prototype.s=function(){throw Error("Abstract method calling.");};f.a.prototype.send=function(){throw Error("Abstract method calling.");};f.a.prototype.L=function(a){this.v=a;for(this.z&&this.z.d("connect",this.v);this.J.length;)this.send(this.J.shift())};
f.a.prototype.M=function(a){if(a){var c;c=a;if(!c.pop)try{c=eval("("+a+")").la}catch(d){}for(;c&&c.length;)this.z.d("message",c.shift())}};f.a.c=function(){f.a.c.h.constructor.call(this);this.F="longPolling";this.r=this.m=this.w=b;this.T="";this.S();var a=this;this.X=function(c){a.L(c)};this.Y=function(c){a.M(c)};this.R=function(){a.z.d("error")};this.w.B("ready",this.X);this.m.B("ready",this.Y);this.w.B("error",this.R);this.m.B("error",this.R)};f.n.t(f.a.c,f.a);f.a.c.U=function(){return!1};
f.a.c.prototype.S=function(){this.w=new f.a.c.o("GET");this.m=new f.a.c.o("GET");this.r=new f.a.c.o("POST")};f.a.c.prototype.s=function(a,c,d){this.N=(d?"https":"http")+"://"+a+":"+c+"/beseda/io";this.w.send(this.N+"/"+this.F)};f.a.c.prototype.L=function(a){if(a!==void 0){var c=a.ba;if(c==b)try{c=eval("("+a+")").ba}catch(d){}if(c)this.r.url=this.m.url=this.N+"/"+this.F+"/"+c,this.r.url+=this.T,f.a.c.h.L.call(this,c),this.v&&this.m.send()}};
f.a.c.prototype.M=function(a){f.a.c.h.M.call(this,a);this.v&&this.m.send()};f.a.c.prototype.send=function(a){this.v?(this.r.data="["+a+"]",this.r.send()):this.J.push(a)};f.a.c.o=function(a){f.a.c.o.h.constructor.call(this);this.url=b;this.method=a||"GET";this.data=b};f.n.t(f.a.c.o,f.k);
f.a.c.o.prototype.send=function(a){if(a)this.url=a;a=this.url;c!=b&&c.abort();var c=+"\u000b1"?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),d=this;c.onreadystatechange=function(){var a=c;a.readyState===4&&(a.status===200?d.d("ready",a.responseText):d.d("error"),a.abort())};this.method==="GET"&&this.data&&(a+=(a.indexOf("?")===-1?"?":"&")+this.data);c.open(this.method,encodeURI(a),!0);a=b;if(this.method==="POST")a=this.data,c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
c.send(a)};f.a.b=function(){f.a.b.h.constructor.call(this);this.F="JSONPLongPolling";this.T="/send"};f.n.t(f.a.b,f.a.c);f.a.b.U=function(){return!0};f.a.b.prototype.S=function(){this.w=new f.a.b.e;this.m=new f.a.b.e;this.r=new f.a.b.e};f.a.b.e=function(){f.a.b.e.h.constructor.call(this);this.url=b;this.data="";this.l=++f.a.b.e.Z;this.i=0;this.p={};f.a.b.e.Q[this.l]={}};f.n.t(f.a.b.e,f.k);f.a.b.e.Q=[];f.a.b.e.Z=0;
f.a.b.e.prototype.send=function(a){if(a)this.url=a;(function(a,d,e){f.a.b.e.Q[d.l][a]=function(g){clearTimeout(e);console.log("request_"+d.l+"_"+a);document.body.removeChild(document.getElementById("request_"+d.l+"_"+a));delete d.p[a];d.d("ready",g)}})(this.i,this,function(a,d){return setTimeout(function(){document.body.removeChild(document.getElementById("request_"+d.l+"_"+a));delete d.p[a];d.d("error")},15E3)}(this.i,this));a=this.url;a+=(a.indexOf("?")===-1?"?":"&")+"callback=Beseda.Transport.JSONPLongPolling.JSONPRequest.__callbacks["+
this.l+"]["+this.i+"]&"+(new Date).getTime()+"&messages="+this.data;this.p[this.i]=document.createElement("script");this.p[this.i].src=a;this.p[this.i].id="request_"+this.l+"_"+this.i;document.body.appendChild(this.p[this.i]);this.data=b;this.i++};f.a.b.ga=function(){f.a.b.e.h.constructor.call(this);this.url=b};